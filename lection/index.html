<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>MongoDB</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/yandex.css" id="theme">
    <link rel="stylesheet" href="../lib/css/zenburn.css">
    <link rel="stylesheet" href="./css/user.css">
</head>
<body class="yandex nodejs"><div class="reveal"><div class="slides">

<section class="large">
    <h3>–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h3>
    <h3>MongoDB</h3>
    <p class="author">
        <small>–ù–∞—Ç–∞–ª—å—è –ê–∫—Å—ë–Ω–æ–≤–∞</small>
    </p>
</section>
<section>
    <section data-transition="none">
        <ol>
            <li>Frontend</li>
            <li>Backend</li>
            <li>????</li>
            <li>PROFIT!!!</li>
        </ol>
    </section>
    <section data-transition="none">
        <ol>
            <li>Frontend</li>
            <li>Backend</li>
            <li>Database</li>
            <li>PROFIT!!!</li>
        </ol>
    </section>
    <section>
        <h2>CAP —Ç–µ–æ—Ä–µ–º–∞</h2>
    </section>
    <section>
        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP" style="width: 85%;">
            –¢–µ–æ—Ä–µ–º–∞ CAP - —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –≤ –ª—é–±–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤–æ–∑–º–æ–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–µ –±–æ–ª–µ–µ –¥–≤—É—Ö –∏–∑ —Ç—Ä—ë—Ö —Å–ª–µ–¥—É—é—â–∏—Ö —Å–≤–æ–π—Å—Ç–≤: —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é.
        </blockquote>
    </section>

    <section>
        <h3>C–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</h3>

        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP">
            (–∞–Ω–≥–ª. consistency) ‚Äî –≤–æ –≤—Å–µ—Ö –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —É–∑–ª–∞—Ö –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É
        </blockquote>
    </section>

    <section>
        <h3>–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</h3>

        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP">
            (–∞–Ω–≥–ª. availability) ‚Äî –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å –∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –æ—Ç–∫–ª–∏–∫–æ–º, –æ–¥–Ω–∞–∫–æ –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ –æ—Ç–≤–µ—Ç—ã –≤—Å–µ—Ö —É–∑–ª–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
        </blockquote>
    </section>

    <section>
        <h3>–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é</h3>

        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP">
            (–∞–Ω–≥–ª. partition tolerance) ‚Äî —Ä–∞—Å—â–µ–ø–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ü–∏–π –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ—Ç–∫–ª–∏–∫–∞ –æ—Ç –∫–∞–∂–¥–æ–π –∏–∑ —Å–µ–∫—Ü–∏–π
        </blockquote>
    </section>

    <section data-background='images/cap.png' data-background-size='contain'>
    </section>
</section>

<section>
    <section>
        <h3>NoSQL</h3>
    </section>
    <section>
        <img src="images/MongoDB_Gray_Logo_FullColor_RGB-01.jpg">
    </section>
    <section>
        <h3>MongoDB</h3>
        <div>–î–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</div>
        <div>–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON-–ø–æ–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ</div>
        <div>–°—Ö–µ–º–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</div>
        <div>–î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Javascript</div>
    </section>
    <section>
        <h4>–£—Å—Ç–∞–Ω–æ–≤–∫–∞</h4>
        <a href="https://www.mongodb.com/download-center#community">https://www.mongodb.com/download-center#community</a>
    </section>
    <section>
        <h4>–ö–æ–ª–ª–µ–∫—Ü–∏–∏</h4>
        <img style="background-color: #fff;" src="images/collection.svg" alt="collection">
    </section>
    <section>
        <h4>–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</h4>
        <pre><code class="hljs javascript size-XXXS">db.createCollection("students", {
   validator: {
      $jsonSchema: {
         bsonType: "object",
         required: [ "name", "year" ],
         properties: {
            name: {
               bsonType: "string",
               description: "must be a string and is required"
            },
            gender: {
               bsonType: "string",
               description: "must be a string and is not required"
            },
            year: {
               bsonType: "int",
               minimum: 2017,
               maximum: 3017,
               description: "must be an integer in [ 2017, 3017 ] and is required"
            }
         }
      }
   }
})</code></pre>
    </section>
</section>
<section>
    <section>
            <h3>CRUD</h3>
        <ul>
            <li>Create</li>
            <li>Read</li>
            <li>Update</li>
            <li>Delete</li>
        </ul>
    </section>
    <section>
        <h4>Create. –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å</h4>
        <pre><code class="hljs javascript size-XS">db.students.insert({
    name: '–ò–≤–∞–Ω',
    age: 20,
    group: '–ö–ë-401'
})
</code></pre>
    </section>
    <section>
        <h4>Create. –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π</h4>
    <pre><code class="hljs javascript">db.students.insert([
    { age: 20, group: '–ö–ë-401' },
    { name: '–ê–Ω–Ω–∞', age: '21 –≥–æ–¥', group: '–ö–ë-401' },
    { name: '–ë–∞—Ä—Å–∏–∫', age: 5, tail: 'long' }
])</code></pre>
        <p class="fragment" style="font-size: 80px;">‚ùì üë© üò∫</p>
    </section>
    <section>
        <img src="images/trash.png">
    </section>
    <section>
        <h4>–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</h4>
        <pre><code class="hljs javascript">db.students.drop()</code></pre>
    </section>
    <section>
        <h4>–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</h4>
        <pre><code class="hljs javascript size-XXS">db.createCollection("students", {
    validator: {
        $jsonSchema: {
            bsonType: "object",
            required: ["name", "group"],
            properties: {
                name: {
                    bsonType: "string",
                    description: "Student name"
                },
                group: {
                    bsonType: "string",
                    description: "Student group"
                },
                age: {
                    bsonType: "number",
                    minimum: 1,
                    maximum: 100,
                    description: "Student age"
                }
            }
        }
    }
})</code></pre>
    </section>
    <section>
        <h4>Create. –£—Å–ø–µ—à–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.insert(
    { name: '–ò–≤–∞–Ω', age: 20, group: '–ö–ë-401' }
)</code></pre>
        <pre class="fragment"><code class="hljs javascript">WriteResult({ "nInserted" : 1 })</code></pre>
    </section>
    <section>
        <h4>Create. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.insert({
    name: '–ë–∞—Ä—Å–∏–∫',
    age: 5,
    group: '–ö–ë-401',
    tail: 'long'
})</code></pre>
        <pre class="fragment"><code class="hljs javascript">WriteResult({ "nInserted" : 1 })</code></pre>
    </section>
    <section>
        <h4>Create. –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.insert({ age: 20, group: '–ö–ë-401' })</code></pre>
        <pre class="fragment"><code class="hljs javascript">WriteResult({
	"nInserted" : 0,
	"writeError" : {
		"code" : 121,
		"errmsg" : "Document failed validation"
	}
})</code></pre>
    </section>

    <section>
        <h4>Read. –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h4>
<pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.find()</code></pre>
<pre class="fragment"><code class="hljs javascript">{ "_id" : ObjectId("5ab00cbffe72f33d2d9b6378"), "name" : "–ò–≤–∞–Ω", "age" : 20, "group" : "–ö–ë-401" }
{ "_id" : ObjectId("5ab00cbffe72f33d2d9b6379"), "name" : "–ë–∞—Ä—Å–∏–∫", "age" : 5, "group" : "–ö–ë-401", "tail" : "long" }</code></pre>
    </section>
    <section>
        <h4>Read. Pretty</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.find().pretty()</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "_id" : ObjectId("5ab00cbffe72f33d2d9b6378"),
    "name" : "–ò–≤–∞–Ω",
    "age" : 20,
    "group" : "–ö–ë-401"
}
{
    "_id" : ObjectId("5ab00cbffe72f33d2d9b6379"),
    "name" : "–ë–∞—Ä—Å–∏–∫",
    "age" : 5,
    "group" : "–ö–ë-401",
    "tail" : "long"
}</code></pre>
    </section>
    <section>
        <h4>Read. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.find().toArray()</code></pre>
        <pre><code class="hljs javascript">[
    {
        "_id" : ObjectId("5ab00cbffe72f33d2d9b6378"),
        "name" : "–ò–≤–∞–Ω",
        "age" : 20,
        "group" : "–ö–ë-401"
    },
    {
        "_id" : ObjectId("5ab00cbffe72f33d2d9b6379"),
        "name" : "–ë–∞—Ä—Å–∏–∫",
        "age" : 5,
        "group" : "–ö–ë-401",
        "tail" : "long"
    }
]</code></pre>
    </section>
    <section>
        <p>ObjectId("5ab00cbffe72f33d2d9b6378")</p>
        <table>
            <tr>
                <td>4 –±–∞–π—Ç–∞</td>
                <td>timestamp</td>
            </tr>
            <tr>
                <td>3 –±–∞–π—Ç–∞</td>
                <td>mid</td>
            </tr>
            <tr>
                <td>2 –±–∞–π—Ç–∞</td>
                <td>pid</td>
            </tr>
            <tr>
                <td>3 –±–∞–π—Ç–∞</td>
                <td>inc</td>
            </tr>
        </table>
    </section>
    <section>
        <h4>Read. Find</h4>
<pre><code class="hljs javascript size-XS">db.collection.find(query, projection)</code></pre>
        <div>
            <ul>
                <li>query - –∑–∞–¥–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∫–∏. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</li>
                <li>projection - –∑–∞–¥–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è</li>
            </ul>
        </div>
    </section>

    <section>
        <h4>Read. Query</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.find({ name: '–ò–≤–∞–Ω' })</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "_id" : ObjectId("5ab00cbffe72f33d2d9b6378"),
    "name" : "–ò–≤–∞–Ω",
    "age" : 20,
    "group" : "–ö–ë-401"
}</code></pre>
    </section>
    <section>
        <h4>Read. Projection</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.find({ name: '–ò–≤–∞–Ω' }, { name: 1, group: 1 })</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "_id" : ObjectId("5ab00cbffe72f33d2d9b6378"),
    "name" : "–ò–≤–∞–Ω",
    "group" : "–ö–ë-401"
}</code></pre>
    </section>
    <section>
        <h4>Read. Projection. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.students.find({ name: '–ò–≤–∞–Ω' }, { _id: 0 })</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "name" : "–ò–≤–∞–Ω",
    "age" : 20,
    "group" : "–ö–ë-401"
}</code></pre>
    </section>
    <section>
        <h4>Read. –û–ø–µ—Ä–∞—Ç–æ—Ä—ã</h4>
        <pre><code class="hljs javascript">db.students.find({
    course: { $gte: 3 },
    group: { $ne: '–ö–ù-301' }
})</code></pre>
        <a href="https://docs.mongodb.com/manual/reference/operator/query/">–°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤</a>
    </section>

    <section>
        <h4>Read. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è</h4>
        <pre><code class="hljs javascript">db.students.find({
    group: { $regex: /–ö–ë/}
})</code></pre>
        <pre><code class="hljs javascript">db.students.find({
    group: /–ö–ë/
})</code></pre>
        <a href="https://docs.mongodb.com/manual/reference/operator/query/regex/">–ü–æ–∏—Å–∫ –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º</a>
    </section>
    <section>
        <h4>Read. –ü–æ–∏—Å–∫ –ø–æ –º–∞—Å—Å–∏–≤—É</h4>
        <pre><code class="hljs javascript">db.groups.insert([
    {
        name: '–ö–ë-401',
        students: [
            '–ò–≤–∞–Ω',
            '–ë–∞—Ä—Å–∏–∫'
        ]
    },
    {
        name: '–ö–ù-301',
        students: [
            '–ê–Ω–Ω–∞',
            '–ò–≤–∞–Ω',
            '–ò–≥–æ—Ä—å'
        ]
    }
])</code></pre>
    </section>
    <section>
        <h4>Read. –ü–æ–∏—Å–∫ –ø–æ –º–∞—Å—Å–∏–≤—É</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.groups.find(
    { students: '–ò–≤–∞–Ω' },
    { _id: 0, name: 1, students: 1 }
)</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "name" : "–ö–ë-401",
    "students" : [ "–ò–≤–∞–Ω", "–ë–∞—Ä—Å–∏–∫" ]
}
{
    "name" : "–ö–ù-301",
    "students" : [ "–ê–Ω–Ω–∞", "–ò–≤–∞–Ω", "–ò–≥–æ—Ä—å" ]
}</code></pre>
    </section>
    <section>
        <h4>Read. –ü–æ–∏—Å–∫ –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º</h4>
        <pre style="margin-bottom: 10px;"><code>{
    name: '–ê–Ω–Ω–∞',
    group: '–ö–ù-301',
    grades: {
        javascript: [1,1,1,1,1,1,1,1,1,1],
        verstka: [1,1,1,1,1,1,0.5,1,1,1,0]
    }
}</code></pre>
        <pre class="fragment"><code class="hljs javascript">db.students.find({
    'grades.javascript.9': 1
})</code></pre>
    </section>
    <section>
        <h4>Read. findOne</h4>
        <pre><code class="hljs javascript">db.students.findOne({ name: '–ë–∞—Ä—Å–∏–∫' })</code></pre>
    </section>
    <section>
        <h4>Update</h4>
        <pre><code class="hljs javascript size-XS">db.collection.update(query, update, options)</code></pre>
        <a href="https://docs.mongodb.com/manual/reference/operator/update/">–°–ø–∏—Å–æ–∫ update –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤</a>
    </section>
    <section>
        <h4>Update. Set</h4>
        <pre><code class="hljs javascript size-XS">db.students.update(
    { group: /1\d{2}/ },    // query
    { $set: { course: 1 }}, // update
    { multi: true }         // options
)</code></pre>
    </section>
    <section>
        <h4>Update. Increment</h4>
        <pre><code class="hljs javascript">db.students.update(
    { tail: { $exists: false }},
    { $inc: { course: 1 }},
    { multi: true }
)</code></pre>
    </section>
    <section>
        <h4>Update. –û—Ç—á–∏—Å–ª–µ–Ω–∏–µ üòø</h4>
        <pre><code class="hljs javascript">db.students.update(
     { tail: { $exists: true }},
     { $set: { isDismissed: true }}
)</code></pre>
        <img class="fragment" height="400" src="images/matmech-cat.jpg">
    </section>
    <section>
        <h4>Update. Pull & Push</h4>
        <pre><code class="hljs javascript">db.groups.update(
    { name: '–ö–ë-401' },
    { $pull: { students: '–ë–∞—Ä—Å–∏–∫' }}
)</code></pre>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.groups.update(
    { name: '–ö–ë-401' },
    { $push: { students: '–ö–∞—Ç—è' }}
)</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "_id" : ObjectId("5ab01e9ffe72f33d2d9b637a"),
    "name" : "–ö–ë-401",
    "students" : [ "–ò–≤–∞–Ω", "–ö–∞—Ç—è" ]
}</code></pre>
    </section>
    <section>
        <h4>Delete</h4>
        <pre style="margin-bottom: 15px;"><code class="hljs javascript" data-trim>db.collection.remove(query, justOne)</code></pre>
        <pre style="margin-bottom: 15px;" class="fragment"><code class="hljs javascript">db.students.remove({})</code></pre>
        <pre class="fragment"><code class="hljs javascript">db.students.remove({}, true)</code></pre>
    </section>
</section>

<section>
    <section data-transition="none">
        <h4>–°–Ω–æ–≤–∞ –ø—Ä–æ –æ—Ç—á–∏—Å–ª–µ–Ω–∏–µ</h4>
        <pre class="fragment" style="margin-bottom: 20px;"><code class="hljs javascript">db.students.update(
     { name: '–ë–∞—Ä—Å–∏–∫' },
     { $set: { isDismissed: true }}
)</code></pre>
        <pre class="fragment"><code class="hljs javascript">db.groups.update(
    { name: '–ö–ë-401' },
    { $pull: { students: '–ë–∞—Ä—Å–∏–∫' }}
)</code></pre>
    </section>
    <section data-transition="none">
        <h4>–°–Ω–æ–≤–∞ –ø—Ä–æ –æ—Ç—á–∏—Å–ª–µ–Ω–∏–µ</h4>
        <pre style="margin-bottom: 20px; background-color: rgba(0,255,0,0.2)"><code class="hljs javascript">db.students.update(
     { name: '–ë–∞—Ä—Å–∏–∫' },
     { $set: { isDismissed: true }}
)</code></pre>
        <pre style="background-color: rgba(255,0,0,0.2)"><code class="hljs javascript">db.groups.update(
    { name: '–ö–ë-401' },
    { $pull: { students: '–ë–∞—Ä—Å–∏–∫' }}
)</code></pre>
    </section>
    <section>
        <h3>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
        <div class="fragment">–ò—Ö –Ω–µ—Ç.</div>
        <div class="fragment">–ù–æ –±—É–¥—É—Ç –≤ MongoDB 4.0</div>
    </section>
</section>


<section>
    <section>
        <h3>–ò–Ω–¥–µ–∫—Å—ã</h3>
    </section>
    <section>
        <h4>–ò–Ω–¥–µ–∫—Å—ã. Explain</h4>
        <pre style="margin-bottom: 15px;"><code class="hljs javascript">db.students
    .find({group: '–ö–ë-501'})
    .explain('executionStats')</code></pre>
        <pre class="fragment"><span>{
    "nReturned" : 1,
    "executionTimeMillis" : 0,
    "totalKeysExamined" : 0,
    <mark>"totalDocsExamined" : 303,</mark>
    "executionStages" : {
        "stage" : "COLLSCAN",
        "filter" : {
            "group" : { "$eq" : "–ö–ë-501" }
        }
    }
}</span></pre>
    </section>
    <section>
        <h3>–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞</h3>
        <pre><code class="hljs javascript size-XS">db.students.createIndex({group: 1})</code></pre>
    </section>
    <section>
        <h3>–ü–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É</h3>
        <pre style="margin-bottom: 15px;"><code class="hljs">db.students
    .find({group: '–ö–ë-501'})
    .explain('executionStats')</code></pre>
        <pre class="fragment"><span>{
    "nReturned" : 1,
    "executionTimeMillis" : 1,
    "totalKeysExamined" : 1,
    <mark>"totalDocsExamined" : 1,</mark>
    "executionStages" : {
        "stage" : "FETCH",
        "inputStage" : {
            "stage" : "IXSCAN",
        }
    }
}</span></pre>
    </section>
    <section>
        <h3>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å. –°–æ–∑–¥–∞–Ω–∏–µ</h3>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript size-XS">db.groups.createIndex({name: 1}, {unique: true})</code></pre>
        <pre class="fragment"><code class="hljs javascript size-XS">db.groups.insert({name: '–ö–ë-401'})</code></pre>
        <pre class="fragment"><code class="hljs javascript size-XS">WriteResult({ "nInserted" : 1 })</code></pre>
    </section>
    <section>
        <h3>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å</h3>
        <pre><code class="hljs javascript size-XS">db.groups.insert({name: '–ö–ë-401'})</code></pre>
        <pre class="fragment"><code class="hljs javascript size-XS">WriteResult({
    "nInserted" : 0,
    "writeError" : {
        "code" : 11000,
        "errmsg" : "E11000 duplicate key
            error collection:
            mongo-lecture.groups
            index: name_1 dup key: { : \"–ö–ë-401\" }"
    }
})</code></pre>
    </section>
    <section>
        <h4>–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å</h4>
        <pre><code class="hljs javascript">db.students.createIndex({
    course: -1,
    group: 1
})</code></pre>
    </section>
    <section>
        <h4>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤</h4>
        <pre><code data-trim class="hljs javascript size-XS">db.students.getIndexes()</code></pre>
        <pre><code data-trim class="hljs json size-XXS">[
	{
		"v" : 2,
		"key" : { "_id" : 1 },
		"name" : "_id_",
		"ns" : "mongo-lecture.students"
	},
	{
		"v" : 2,
		"key" : { "group" : 1 },
		"name" : "group_1",
		"ns" : "mongo-lecture.students"
	}
]</code></pre>
    </section>
</section>
<section>
    <section>
        <h2>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
    </section>
    <section>
        <h4>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è. –ó–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ</h4>
        <img style="background-color: #fff;" src="images/replica-set-1.svg">
    </section>
    <section>
        <h4>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã</h4>
        <img style="background-color: #fff;" src="images/replica-set-2.svg">
    </section>
    <section>
        <h4>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è. –û—Ç–∫–∞–∑ —É–∑–ª–∞</h4>
        <img style="background-color: #fff;" src="images/replica-set-3.svg">
    </section>
    <section data-background='images/cap.png' data-background-size='contain'>
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
        <img style="background-color: #fff;" src="images/Biggest%20Book%20Ever.jpg">
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
        <img style="background-color: #fff;" width="600" src="images/sharded-collection.png">
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ. Range-based</h4>
        <img style="background-color: #fff;" src="images/sharded-cluster-ranged-distribution-good.bakedsvg.svg">
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ. Hash-based</h4>
        <img style="background-color: #fff;" src="images/sharded-cluster-hashed-distribution.bakedsvg.svg">
    </section>
</section>


<section>
    <section>
        <h2>ODM</h2>
        <span>Object Document Mapper</span>
    </section>
    <section>
        <h2>Mongoose</h2>
    </section>
    <section>
        <h3>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
        <pre style="margin-bottom: 15px;"><code class="hljs bash">npm install mongoose</code></pre>
        <pre><code data-trim class="hljs javascript">const mongoose = require('mongoose');
const URI = 'mongodb://localhost/mongo-lecture';

mongoose.connect(URI).then(
    () => { /** ready to use */ },
    err => { /** handle initial connection error */ }
)</code></pre>
    </section>
    <section>
        <h4>–°—Ö–µ–º—ã</h4>
        <pre><code class="hljs javascript">const Schema = mongoose.Schema;

const studentSchema = new Schema({
    name: { type: String, required: true },
    age: {
        type: Number,
        min: 1, max: 100,
        required: true
    },
    course: Number,
    group: { type: String, required: true }
});</code></pre>
        <a href="http://mongoosejs.com/docs/schematypes.html" class="size-S">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Å—Ö–µ–º—ã</a>
    </section>
    <section>
        <h4>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º</h4>
        <pre><code class="hljs javascript">studentSchema.add({
    course: { type: Number, default: 1 },
    group: { type: String, uppercase: true, required: true }
});</code></pre>
    </section>
    <section>
        <h3>–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö</h3>
        <table>
            <tr>
                <td>String</td>
                <td>Number</td>
            </tr>
            <tr>
                <td>Date</td>
                <td>Buffer</td>
            </tr>
            <tr>
                <td>Boolean</td>
                <td>Array</td>
            </tr>
            <tr>
                <td>ObjectID</td>
                <td>Mixed</td>
            </tr>
        </table>
    </section>
    <section>
        <h3>–°—Ö–µ–º—ã. –ò–Ω–¥–µ–∫—Å—ã</h3>
        <pre><code class="hljs javascript">const groupSchema = new Schema({
    name: {
        type: String, index: true, unique: true
    },
    students: [String]
});</code></pre>
    </section>
    <section>
        <h3>–ú–æ–¥–µ–ª–∏</h3>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">const Student = mongoose.model('Student', studentSchema);</code></pre>
<pre class="fragment"><code class="hljs javascript">const ivan = new Student({
    name: '–ò–≤–∞–Ω',
    age: 20,
    group: '–∫–±-101'
});</code></pre>
        <pre class="fragment"><code class="hljs javascript">console.log(ivan.name); // "–ò–≤–∞–Ω"
console.log(ivan.group); // "–ö–ë-101"
console.log(ivan.course); // 1
        </code></pre>
    </section>
    <section>
        <h3>–ú–æ–¥–µ–ª–∏. –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ–ª—è</h3>
        <pre><code class="hljs javascript">studentSchema.virtual('nameAndGroup').get(function () {
  return `${this.name}, –≥—Ä—É–ø–ø–∞ ${this.group}`;
});</code></pre>
<pre class="fragment"><code class="hljs javascript">const Student = mongoose.model('Student', studentSchema);

const ivan = new Person({
    name: '–ò–≤–∞–Ω',
    age: 20,
    group: '–∫–±-101'
});</code></pre>
        <pre class="fragment"><code class="hljs javascript">console.log(ivan.nameAndGroup); // –ò–≤–∞–Ω, –≥—Ä—É–ø–ø–∞ –ö–ë-401</code></pre>
    </section>
    <section>
        <h2>CRUD</h2>
    </section>
    <section>
        <h3>Create</h3>
        <pre><code class="hljs javascript">const student = new Student({
    name: '–ò–≤–∞–Ω',
    group: '–ö–ë-401',
    course: 4
});</code></pre>
        <pre class="fragment"><code class="hljs javascript">student
    .save()
    .then(function (savedStudent) {})
    .catch(function (err) {});</code></pre>
    </section>
    <section>
        <h3>Read</h3>
        <pre><code class="hljs javascript">const query = Student.findOne({name: '–ò–≤–∞–Ω'});</code></pre>
        <pre class="fragment"><code class="hljs javascript">query.where({group: '–ö–ë-401'});
query.select({name: 1, group: 1});

query.exec(function (err, student) {
    if (err) { console.log(err); }
    console.log('found student:', student);
});</code></pre>
    </section>
    <section>
        <h3>Read</h3>
        <pre><code class="hljs javascript">Student
    .find({ course: { $gt: 1 }})
    .limit(20)
    .sort({ course: 1, group: 1 })
    .select({ course: 1, group: 1, name: 1 })
    .exec(callback);</code></pre>
    </section>
    <section>
        <h3>Update</h3>
        <pre><code class="hljs javascript">student.update({ $inc: { course: 1 }})</code></pre>
    </section>
    <section>
        <h3>Update</h3>
        <pre><code class="hljs javascript">Student.findById(
    ObjectId("5aad01f2cd1cce7ab360e829"),
    function (err, student) {
        student.course = 5;
        student.save(callback);
    }
);</code></pre>
    </section>
    <section>
        <h3>Update</h3>
        <pre><code class="hljs javascript">Student.update(
            {},
            { $inc: { course: 1 }},
            { multi: true },
            callback
)</code></pre>
    </section>
    <section>
        <h3>Delete</h3>
        <pre><code class="hljs javascript">Student.remove({group: '–ö–ù-401'})</code></pre>
    </section>
    <section>
        <h3>–ò–Ω–¥–µ–∫—Å—ã</h3>
    </section>
</section>
<section>
    <h2>–°—Å—ã–ª–∫–∏</h2>
</section>


<script src="../lib/js/head.min.js"></script>
<script src="../js/reveal.js"></script>
<script>
    Reveal.initialize({
        controls: false,
        progress: true,
        slideNumber: true,
        history: true,
        center: true,
        hideAddressBar: true,
        transition: 'slide',
        dependencies: [
            {
                src: '../plugin/highlight/highlight.js',
                async: true,
                condition: function () {
                    return Boolean(document.querySelector('pre code'));
                },
                callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });
</script>
</body>
</html>
